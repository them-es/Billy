(()=>{"use strict";const t=window.wp.i18n,l=window.wp.blocks,e=window.wp.blockEditor,a=window.wp.element,s=window.wp.data,n=window.wp.components,c=(t,l=void 0)=>t.toLocaleString(l,{minimumFractionDigits:2,maximumFractionDigits:2}),o=t=>parseFloat(t)/100,r=window.ReactJSXRuntime;let i;const d=[{attributes:{currency:{type:"string",default:""},locale:{type:"string",default:""},amountSubtotal:{type:"number",default:""},amountTotal:{type:"number",default:""},taxRates:{type:"string",default:""},taxRatesTotal:{type:"number",default:""}},save:l=>{const{className:s,attributes:{currency:n,locale:i,amountSubtotal:d,amountTotal:u,taxRates:x,taxRatesTotal:b}}=l,h=e.useBlockProps.save({className:"invoicetable-block alignwide"+(s?" "+s:"")});return(0,r.jsx)("div",{...h,children:(0,r.jsxs)("table",{className:"table wp-block-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",children:"#"}),(0,r.jsx)("th",{scope:"col",children:"Beschreibung"}),(0,r.jsx)("th",{scope:"col",children:"Betrag"}),x&&b>0&&(0,r.jsx)("th",{scope:"col",children:"Steuer"})]})}),(0,r.jsx)("tbody",{children:(0,r.jsx)(e.InnerBlocks.Content,{})}),(0,r.jsxs)("tfoot",{children:[d>0&&(0,r.jsxs)("tr",{className:"subtotal",children:[(0,r.jsx)("th",{colSpan:"2",children:u>d?"Zwischensumme":"Gesamtsumme"}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),n,c(d,i))})]}),x&&b>0&&(0,r.jsxs)("tr",{className:"taxrates",children:[(0,r.jsx)("th",{colSpan:"2",children:"Steuer"}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:JSON.parse(x).sort((t,l)=>o(t.taxRate)-o(l.taxRate)).map((l,e)=>{if(l.amount>0)return(0,r.jsx)(a.RawHTML,{children:(0,t.sprintf)((0,t.__)("%1$s %2$s %3$s","billy"),n,c(l.amount,i),"<small>("+l.taxRate+")</small><br>")},e)})})]}),u>d&&(0,r.jsxs)("tr",{className:"total",children:[(0,r.jsx)("th",{colSpan:"2",children:"Gesamtsumme"}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),n,c(u,i))})]})]})]})})}},{attributes:{currency:{type:"string",default:""},locale:{type:"string",default:""},amountSubtotal:{type:"number",default:""},amountTotal:{type:"number",default:""},taxRates:{type:"string",default:""},taxRatesTotal:{type:"number",default:""}},save:l=>{const{className:s,attributes:{currency:n,locale:i,amountSubtotal:d,amountTotal:u,taxRates:x,taxRatesTotal:b}}=l,h=e.useBlockProps.save({className:"invoicetable-block alignwide"+(s?" "+s:"")});return(0,r.jsx)("div",{...h,children:(0,r.jsxs)("table",{className:"table wp-block-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",children:"#"}),(0,r.jsx)("th",{scope:"col",children:"Description"}),(0,r.jsx)("th",{scope:"col",children:"Amount"}),x&&b>0&&(0,r.jsx)("th",{scope:"col",children:"Tax"})]})}),(0,r.jsx)("tbody",{children:(0,r.jsx)(e.InnerBlocks.Content,{})}),(0,r.jsxs)("tfoot",{children:[d>0&&(0,r.jsxs)("tr",{className:"subtotal",children:[(0,r.jsx)("th",{colSpan:"2",children:u>d?"Subtotal":"Total"}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),n,c(d,i))})]}),x&&b>0&&(0,r.jsxs)("tr",{className:"taxrates",children:[(0,r.jsx)("th",{colSpan:"2",children:"Tax"}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:JSON.parse(x).sort((t,l)=>o(t.taxRate)-o(l.taxRate)).map((l,e)=>{if(l.amount>0)return(0,r.jsx)(a.RawHTML,{children:(0,t.sprintf)((0,t.__)("%1$s %2$s %3$s","billy"),n,c(l.amount,i),"<small>("+l.taxRate+")</small><br>")},e)})})]}),u>d&&(0,r.jsxs)("tr",{className:"total",children:[(0,r.jsx)("th",{colSpan:"2",children:"Total"}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),n,c(u,i))})]})]})]})})}},{attributes:{currency:{type:"string",default:""},locale:{type:"string",default:""},amountSubtotal:{type:"number",default:""},amountTotal:{type:"number",default:""},taxRates:{type:"string",default:""},taxRatesTotal:{type:"number",default:""}},save:l=>{const{className:s,attributes:{currency:n,locale:i,amountSubtotal:d,amountTotal:u,taxRates:x,taxRatesTotal:b}}=l,h=e.useBlockProps.save({className:"invoicetable-block alignwide"+(s?" "+s:"")});return(0,r.jsx)("div",{...h,children:(0,r.jsxs)("table",{className:"table wp-block-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",children:(0,t.__)("#","billy")}),(0,r.jsx)("th",{scope:"col",children:(0,t.__)("Description","billy")}),(0,r.jsx)("th",{scope:"col",children:(0,t.__)("Amount","billy")}),x&&b>0&&(0,r.jsx)("th",{scope:"col",children:(0,t.__)("Tax","billy")})]})}),(0,r.jsx)("tbody",{children:(0,r.jsx)(e.InnerBlocks.Content,{})}),(0,r.jsxs)("tfoot",{children:[d>0&&(0,r.jsxs)("tr",{className:"subtotal",children:[(0,r.jsx)("th",{colSpan:"2",children:u>d?(0,t.__)("Subtotal","billy"):(0,t.__)("Total","billy")}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),n,c(d,i))})]}),x&&b>0&&(0,r.jsxs)("tr",{className:"taxrates",children:[(0,r.jsx)("th",{colSpan:"2",children:(0,t.__)("Tax","billy")}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:JSON.parse(x).sort((t,l)=>o(t.taxRate)-o(l.taxRate)).map((l,e)=>{if(l.amount>0)return(0,r.jsx)(a.RawHTML,{children:(0,t.sprintf)((0,t.__)("%1$s %2$s %3$s","billy"),n,c(l.amount,i),"<small>("+l.taxRate+")</small><br>")},e)})})]}),u>d&&(0,r.jsxs)("tr",{className:"total",children:[(0,r.jsx)("th",{colSpan:"2",children:(0,t.__)("Total","billy")}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),n,c(u,i))})]})]})]})})}},{attributes:{currency:{type:"string",default:""},locale:{type:"string",default:""},amountSubtotal:{type:"number",default:""},amountTotal:{type:"number",default:""},taxRates:{type:"string",default:""},taxRatesTotal:{type:"number",default:""}},save:l=>{const{className:s,attributes:{currency:n,locale:i,amountSubtotal:d,amountTotal:u,taxRates:x,taxRatesTotal:b}}=l;return(0,r.jsx)("div",{className:"invoicetable-block alignwide"+(s?" "+s:""),children:(0,r.jsxs)("table",{className:"table wp-block-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",children:(0,t.__)("#","billy")}),(0,r.jsx)("th",{scope:"col",children:(0,t.__)("Description","billy")}),(0,r.jsx)("th",{scope:"col",children:(0,t.__)("Amount","billy")}),x&&b>0&&(0,r.jsx)("th",{scope:"col",children:(0,t.__)("Tax","billy")})]})}),(0,r.jsx)("tbody",{children:(0,r.jsx)(e.InnerBlocks.Content,{})}),(0,r.jsxs)("tfoot",{children:[d>0&&(0,r.jsxs)("tr",{className:"subtotal",children:[(0,r.jsx)("td",{colSpan:"2",className:"align-right",children:u>d?(0,t.__)("Subtotal","billy"):(0,t.__)("Total","billy")}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),n,c(d,i))})]}),x&&b>0&&(0,r.jsxs)("tr",{className:"taxrates",children:[(0,r.jsx)("td",{colSpan:"2",className:"align-right",children:(0,t.__)("Tax","billy")}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:JSON.parse(x).sort((t,l)=>o(t.taxRate)-o(l.taxRate)).map((l,e)=>{if(l.amount>0)return(0,r.jsx)(a.RawHTML,{children:(0,t.sprintf)((0,t.__)("%1$s %2$s %3$s","billy"),n,c(l.amount,i),"<small>("+l.taxRate+")</small><br>")},e)})})]}),u>d&&(0,r.jsxs)("tr",{className:"total",children:[(0,r.jsx)("td",{colSpan:"2",className:"align-right",children:(0,t.__)("Total","billy")}),(0,r.jsx)("td",{colSpan:x&&b>0?"2":null,children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),n,c(u,i))})]})]})]})})}},{attributes:{currency:{type:"string",default:""},locale:{type:"string",default:""},amountSubtotal:{type:"number",default:""},amountTotal:{type:"number",default:""},taxRates:{type:"string",default:""},taxRatesTotal:{type:"number",default:""}},save:l=>{const{className:s,attributes:{currency:n,locale:i,amountSubtotal:d,amountTotal:u,taxRates:x,taxRatesTotal:b}}=l;return(0,r.jsx)("div",{className:"invoicetable-block alignwide"+(s?" "+s:""),children:(0,r.jsxs)("table",{className:"table wp-block-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",children:(0,t.__)("#","billy")}),(0,r.jsx)("th",{scope:"col",children:(0,t.__)("Description","billy")}),(0,r.jsx)("th",{scope:"col",children:(0,t.__)("Amount","billy")}),x&&b>0&&(0,r.jsx)("th",{scope:"col",children:(0,t.__)("Tax","billy")})]})}),(0,r.jsx)("tbody",{children:(0,r.jsx)(e.InnerBlocks.Content,{})}),(0,r.jsxs)("tfoot",{children:[d>0&&(0,r.jsxs)("tr",{className:"subtotal",children:[(0,r.jsx)("td",{colSpan:"2",align:"right",children:u>d?(0,t.__)("Subtotal","billy"):(0,t.__)("Total","billy")}),(0,r.jsx)("td",{children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),n,c(d,i))})]}),x&&b>0&&(0,r.jsxs)("tr",{className:"taxrates",children:[(0,r.jsx)("td",{colSpan:"2",align:"right",children:(0,t.__)("Tax","billy")}),(0,r.jsx)("td",{children:JSON.parse(x).sort((t,l)=>o(t.taxRate)-o(l.taxRate)).map((l,e)=>{if(l.amount>0)return(0,r.jsx)(a.RawHTML,{children:(0,t.sprintf)((0,t.__)("%1$s %2$s %3$s","billy"),n,c(l.amount,i),"<small>("+l.taxRate+")</small><br>")},e)})})]}),u>d&&(0,r.jsxs)("tr",{className:"total",children:[(0,r.jsx)("td",{colSpan:"2",align:"right",children:(0,t.__)("Total","billy")}),(0,r.jsx)("td",{children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),n,c(u,i))})]})]})]})})}}],u=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"billy-blocks/invoice-table","title":"Invoice Table","icon":"menu-alt","category":"billy-blocks","allowedBlocks":["billy-blocks/invoice-tablerow"],"textdomain":"billy","attributes":{"currency":{"type":"string","default":""},"locale":{"type":"string","default":""},"amountSubtotal":{"type":"number","default":""},"amountTotal":{"type":"number","default":""},"taxRates":{"type":"string","default":""},"taxRatesTotal":{"type":"number","default":""}},"supports":{"inserter":false,"reusable":false,"html":false},"editorScript":"file:./index.js"}'),{name:x}=u;(0,l.registerBlockType)({name:x,...u},{getEditWrapperProps:()=>({"data-align":"wide"}),edit:function({clientId:d,className:u,attributes:{currency:x,locale:b,amountSubtotal:h,amountTotal:p,taxRates:m,taxRatesTotal:j},setAttributes:y}){const _=(0,e.useBlockProps)({className:"invoicetable-block"+(u?" "+u:"")}),f=(0,s.useSelect)(t=>{const{getBlock:l}=t("core/block-editor"),e=l(d);return e?e.innerBlocks:[]},[d]);i=()=>{let t=0,l=0,e=0;const a=[],s=[];y({currency:globalDataBilly.currency,locale:globalDataBilly.locale}),f?.length&&(f.forEach(e=>{const s=Number(e.attributes.amount)||0,n=o(e.attributes.taxRate);t+=s,l+=s+n*s,a.push({taxRate:e.attributes.taxRate,amount:n*s})}),a?.length&&(e=a.reduce((t,{amount:l})=>t+l,0),e=Number(e.toFixed(2)),a.forEach(({taxRate:t,amount:l})=>{const e=s.find(l=>l.taxRate===t);e?e.amount+=l:s.push({taxRate:t,amount:l})})),y({taxRatesTotal:e,taxRates:JSON.stringify(s),amountSubtotal:t,amountTotal:l}))},(0,a.useEffect)(()=>{i()},[f]);const S="billy-blocks/invoice-tablerow",R=()=>{(0,s.dispatch)("core/block-editor").insertBlocks([(0,l.createBlock)(S)],f.length,d)};return(0,r.jsxs)("div",{..._,children:[(0,r.jsx)(e.InspectorControls,{children:(0,r.jsx)(n.PanelBody,{title:(0,t.__)("Actions","billy"),children:(0,r.jsx)("button",{id:"updatetotals",className:"components-button is-secondary is-button",onClick:i,children:(0,t.__)("Update Totals","billy")})})}),(0,r.jsx)(e.InnerBlocks,{templateLock:!1,directInsert:!0,template:[[S]],allowedBlocks:[S],defaultBlock:{name:S},renderAppender:()=>(0,r.jsx)("button",{className:"components-button block-editor-button-block-appender",onClick:R,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false",children:(0,r.jsx)("path",{d:"M11 12.5V17.5H12.5V12.5H17.5V11H12.5V6H11V11H6V12.5H11Z"})})})}),h>0&&(0,r.jsx)("table",{className:"totals",children:(0,r.jsxs)("tbody",{children:[(0,r.jsxs)("tr",{className:"subtotal",children:[(0,r.jsx)("th",{style:{width:"50%"},children:p>h?(0,t.__)("Subtotal","billy"):(0,t.__)("Total","billy")}),(0,r.jsx)("td",{children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),x,c(h,b))})]}),m&&j>0&&(0,r.jsxs)("tr",{className:"taxRates",children:[(0,r.jsx)("th",{style:{width:"50%"},children:(0,t.__)("Tax","billy")}),(0,r.jsx)("td",{children:JSON.parse(m).sort((t,l)=>o(t.taxRate)-o(l.taxRate)).map((l,e)=>{if(l.amount>0)return(0,r.jsx)(a.RawHTML,{children:(0,t.sprintf)((0,t.__)("%1$s %2$s %3$s","billy"),x,c(l.amount,b),"<small>("+l.taxRate+")</small><br>")},e)})})]}),p>h&&(0,r.jsxs)("tr",{className:"total",children:[(0,r.jsx)("th",{style:{width:"50%"},children:(0,t.__)("Total","billy")}),(0,r.jsx)("td",{children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),x,c(p,b))})]})]})})]})},save:function({className:l,attributes:{currency:s,locale:n,amountSubtotal:i,amountTotal:d,taxRates:u,taxRatesTotal:x}}){const b=e.useBlockProps.save({className:"invoicetable-block alignwide"+(l?" "+l:"")});return(0,r.jsx)("div",{...b,children:(0,r.jsxs)("table",{className:"table wp-block-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col","data-label":"title"}),(0,r.jsx)("th",{scope:"col","data-label":"description"}),(0,r.jsx)("th",{scope:"col","data-label":"amount"}),u&&x>0&&(0,r.jsx)("th",{scope:"col","data-label":"tax"})]})}),(0,r.jsx)("tbody",{children:(0,r.jsx)(e.InnerBlocks.Content,{})}),(0,r.jsxs)("tfoot",{children:[i>0&&(0,r.jsxs)("tr",{className:"subtotal",children:[(0,r.jsx)("th",{colSpan:"2","data-label":d>i?"subtotal":"total"}),(0,r.jsx)("td",{colSpan:u&&x>0?"2":null,children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),s,c(i,n))})]}),u&&x>0&&(0,r.jsxs)("tr",{className:"taxrates",children:[(0,r.jsx)("th",{colSpan:"2","data-label":"tax"}),(0,r.jsx)("td",{colSpan:u&&x>0?"2":null,children:JSON.parse(u).sort((t,l)=>o(t.taxRate)-o(l.taxRate)).map((l,e)=>{if(l.amount>0)return(0,r.jsx)(a.RawHTML,{children:(0,t.sprintf)((0,t.__)("%1$s %2$s %3$s","billy"),s,c(l.amount,n),"<small>("+l.taxRate+")</small><br>")},e)})})]}),d>i&&(0,r.jsxs)("tr",{className:"total",children:[(0,r.jsx)("th",{colSpan:"2","data-label":"total"}),(0,r.jsx)("td",{colSpan:u&&x>0?"2":null,children:(0,t.sprintf)((0,t.__)("%1$s %2$s","billy"),s,c(d,n))})]})]})]})})},deprecated:d})})();